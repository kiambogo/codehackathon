<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html ng-app="project">
<head>

<title>Taxr - Visualize Your Tax Breakdown</title>
<meta name="author" content="Nicole, Chris, Anthony and Rahin">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=false">
<meta name="description" content="CODE Hackathon Project - Taxr">
<link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/style.css">
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
<link rel="icon" href="img/favicon.ico" type="image/x-icon">

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular-resource.min.js">
</script>
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular-route.min.js">
</script>
</head>
<body>
	<div class="logo_wrapper">
		<img id="logo_png" src="img/logo_no_bg.png">
	</div>
	<!-- HEADER -->
	<div class="intro_wrapper">
		<div class="timeline">
		</div>
		<div class="content">
			<div id="divider"></div>
			<img id="circle_flag" src="img/circle_flag.png">
			<h2>In 2012, the government of Canada received</h2>
			<h2><span>$324,797,234,937</span> in tax.</h2>
			<h3>Have you ever wondered where your tax goes?</h3>
			<a href="#" class="cta">View Breakdown</a>
			<a href="#" class="cta secondary">Salary Decomposed</a>
		</div>
	</div><!--  intro_wrapper -->
	<div class="intro_background">
		<div class="fadeout"></div>
	</div><!--  intro_background -->

	<!-- D3 THINGS -->
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<div class="d3_graphic">
		<img id="circle_bubble" src="img/circle_graph.png">
		<form>
		  <label><input type="radio" name="mode" value="size"> Size</label>
		  <label><input type="radio" name="mode" value="count" checked> Count</label>

		  
		</form>
		<div class="data_description">
			<div class="data_percentage" style="display:none">
				<div id="percentage">helloWorld</div>
				<p>Value</p>
				<div id="value">Value</div>
			</div>
			<div id="data_text">
				<h2>jelly-o oat cake chocolate</h2>
				<p>Cheesecake cheesecake pastry gummies croissant donut. Oat cake biscuit cookie powder. Gingerbread liquorice bear claw chocolate soufflé. Oat cake powder cotton candy pastry ice cream caramels soufflé apple pie carrot cake. Lemon drops cookie applicake. Bear claw chocolate cake fruitcake. Donut ice cream chupa chups cotton candy powder applicake lemon drops jelly. Icing muffin chupa chups unerdwear.com ice cream wafer chupa chups gingerbread jelly beans. Tootsie roll bear claw halvah.</p>
				<a class="cta_small cta_red">More information</a>
				<a class="cta_small" id="back">Go Back</a>

			</div>
		</div>
		<script>
			var width = 1200,
			    height = 700,
			    radius = Math.min(width, height) / 2,
			    color = d3.scale.category20c();

			var svg = d3.select(".d3_graphic").append("svg")
			    .attr("width", width)
			    .attr("height", height)
			    .append("g")
			    .attr("transform", "translate(" + width / 2 + "," + height * .52 + ")");

			var partition = d3.layout.partition()
			    .sort(null)
			    .size([2 * Math.PI, radius * radius])
			    .value(function(d) { return 1; });
			var temp = 0;
			var arc = d3.svg.arc()
			    .startAngle(function(d) { return d.x; })
			    .endAngle(function(d) { return d.x + d.dx; })
			    .innerRadius(function(d) { return Math.sqrt(d.y); })
			    .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

			// Total size of all segments; we set this later, after loading the data.
			var totalSize = 0; 

			//function jsonImport(){
			d3.json('flare.json', function(error, root) {
			  var path = svg.datum(root).selectAll("path")
			      .data(partition.nodes)
			    .enter().append("path")
			      .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
			      .attr("d", arc)
			      .style("stroke", "#fff")
			      .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
			      .style("fill-rule", "evenodd")
			      .each(stash)
			      .on("mouseover", mouseover)
			      .on("click", onClick);
			//  }
			  //jsonImport();

			  d3.selectAll("input").on("change", function change() {
			    var value = this.value === "count"
			        ? function() { return 1; }
			        : function(d) { return d.size; };

			    path
			        .data(partition.value(value).nodes)
			        .transition()
			        .duration(1500)
			        .attrTween("d", arcTween)
			  });
			  // Get total size of the tree = value of root node from partition.
			  totalSize = path.node().__data__.value;
			});

			// Stash the old values for transition.
			function stash(d) {
			  d.x0 = d.x;
			  d.dx0 = d.dx;
			}

			// Interpolate the arcs in data space.
			function arcTween(a) {
			  var i = d3.interpolate({x: a.x0, dx: a.dx0}, a);
			  return function(t) {
			    var b = i(t);
			    a.x0 = b.x;
			    a.dx0 = b.dx;
			    return arc(b);
			  };
			}

			function onClick(d){
				//alert("clicked");
				d3.selectAll("path").on("mouseover", null);
				d3.selectAll("path")
					.transition()
					.attr("transform", "translate("+(-500)+"," + 0 + ")"+"rotate(150)")
					.duration(1500);
				$("#data_text").delay(1500).fadeIn();
			}

			function mouseover(d) {
				  var sequenceArray = getAncestors(d);
				  // Fade all the segments.
			  	  d3.selectAll("path")
			  	  	.transition()
			      	.style("opacity", 0.3);

		      		var percentage = (100 * d.value / totalSize).toPrecision(3);
		      		var value = d.value * 100;
					var percentageString = percentage + "%";
				 	 if (percentage < 0.1) {
				 	   percentageString = "< 0.1%";
					  }

			  		d3.select("#percentage")
			   		   .text(percentageString);
			   		   d3.select("#value")
			   		   .text(value);

			      // Then highlight only those that are an ancestor of the current segment.
				  svg.selectAll("path")
				      .filter(function(node) {
				                return (sequenceArray.indexOf(node) >= 0);
				              })
				      .style("opacity", 1.0)
				      .transition();
				}
			function mouseleave(d) {
			  // Deactivate all segments during transition.
			  d3.selectAll("path")
		      .transition()
		      .duration(1500)
		      .style("opacity", 1)
		      .each("end", function() {
	              d3.select(this).on("mouseover", mouseover);
	           });
			}
			function rotateReverse(){
			    d3.selectAll("path").on("mouseover", null);
				d3.selectAll("path")
					.transition()
					.attr("transform", "translate("+(0)+"," + (-50) + ")"+"rotate(-150)")
					.duration(1000)
					.each("end", function() {
		               d3.select(this).on("mouseover", mouseover);
		            });

			 	d3.selectAll("path").on("mouseover", null);
				$('#data_text').fadeOut();
			}

			// Given a node in a partition layout, return an array of all of its ancestor
			// nodes, highest first, but excluding the root.
			function getAncestors(node) {
			  var path = [];
			  var current = node;
			  while (current.parent) {
			    path.unshift(current);
			    current = current.parent;
			  }
			  return path;
			}


			  
			d3.select("#back").on("click", rotateReverse);

			d3.select("svg g").on("mouseleave", mouseleave);
			
			d3.select(self.frameElement).style("height", height + "px");
		</script>
	</div><!-- d3_graphic -->
	<div class="clearfix"></div>


	<!-- CATEGORY -->
	<div class="category_wrapper">
		<ul class="category_navbar">
			<li class="active"><a>Personnel</a></li>
			<li><a>Transportation</a></li>
			<li><a>Information</a></li>
			<li><a>Health</a></li>
		</ul>
		<div class="category_item">
			<img id="circle_bubble" src="img/circle_personnel.png">
			<h2>Personnel expenditures</h2>
			<p>Halvah candy bear claw jelly-o oat cake chocolate cake pastry candy canes. Sweet roll sugar plum powder cake gummies apple pie toffee oat cake applicake. Tiramisu carrot cake macaroon bear claw soufflé ice cream soufflé pudding liquorice. Lemon drops chocolate candy jelly beans cheesecake marshmallow bonbon sweet jelly-o. Jelly pie dessert candy canes gingerbread wafer chocolate pie. </p>
			<a class="cta_small">More information</a>
		</div><!-- category_item -->
		<div class="category_item">
			<img id="circle_bubble" src="img/circle_personnel.png">
			<h2>Personnel expenditures</h2>
			<p>Halvah candy bear claw jelly-o oat cake chocolate cake pastry candy canes. Sweet roll sugar plum powder cake gummies apple pie toffee oat cake applicake. Tiramisu carrot cake macaroon bear claw soufflé ice cream soufflé pudding liquorice. Lemon drops chocolate candy jelly beans cheesecake marshmallow bonbon sweet jelly-o. Jelly pie dessert candy canes gingerbread wafer chocolate pie. </p>
			<a class="cta_small">More information</a>
			<a class="cta_small cta_red">Visualize it</a>
		</div><!-- category_item -->
		<div class="category_item">
			<img id="circle_bubble" src="img/circle_personnel.png">
			<h2>Personnel expenditures</h2>
			<p>Halvah candy bear claw jelly-o oat cake chocolate cake pastry candy canes. Sweet roll sugar plum powder cake gummies apple pie toffee oat cake applicake. Tiramisu carrot cake macaroon bear claw soufflé ice cream soufflé pudding liquorice. Lemon drops chocolate candy jelly beans cheesecake marshmallow bonbon sweet jelly-o. Jelly pie dessert candy canes gingerbread wafer chocolate pie. </p>
			<a class="cta_small">More information</a>
		</div><!-- category_item -->

	</div><!-- category_wrapper -->
</body>
</html>
